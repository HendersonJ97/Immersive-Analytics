<!DOCTYPE html>
<meta charset="utf-8">

<head>
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
  <script src="https://raw.githubusercontent.com/alexrkass/aframe-no-click-look-controls/master/dist/aframe-no-click-look-controls.min.js"></script>
</head>

<body style='margin : 0px; overflow: hidden;'>

  <script>
    var width = 960,
      height = 500;

    var x = d3.scale.ordinal()
      .rangePoints([0, width], 1),
      y = {},
      dragging = {};

    var line = d3.svg.line();
    var background, foreground;

    var offsetx = 500;
    var offsetz = 0;

    d3.csv("cars.csv", function(cars) {

      x.domain(dimensions = d3.keys(cars[0]) // get column names (leaving as global)
        .filter(function(column_name) {
          return column_name != "name" && (y[column_name] = d3.scale.linear() // Discard names
            .domain(d3.extent(cars, function(max_values) { // create scale from max column values
              return +max_values[column_name]
            }))
            .range([height, 0]))
        }));

      var lines = d3.select("a-scene").selectAll("a-entity")
        .data(cars)
        .enter()
        .append("a-entity")
        .each(function(datum, index) {
          // Select itself
          var entity = d3.select(this);
          var coordinates = dimensions.map(function(column_name) {
            return [x(column_name), y[column_name](datum[column_name])];
          });
          //console.log("coords", coordinates);
          // Loop for each dimension
          for (i = 0; i < coordinates.length - 1; i++) {
            var value = "start: " + offsetx + " " + coordinates[i][1] + " " + (coordinates[i][0] + offsetz) +
              "; end: " + offsetx + " " + coordinates[i + 1][1] + " " + (coordinates[i + 1][0] + offsetz) +
              "; color: red";
            //console.log("lines", value);
            entity.attr("line__" + (i + 1), value);
          }
        })

        var plane = d3.select("a-scene")
          .append("a-plane")
          .attr("position", offsetx + " " + 0 + " " + x(dimensions[0]))
          .attr("height", height)
          .attr("width", width);

    })

    AFRAME.registerComponent('drag-selection', {
      init: function() {
        var downPosition = new THREE.Vector3();
        var upPosition = new THREE.Vector3();
        this.el.addEventListener('mousedown', function(evt) {
          console.log(evt.detail.intersection);
          downPosition = evt.detail.intersection.point;
          console.log("down", downPosition);
        });
        this.el.addEventListener('mouseup', function(evt) {
          console.log(evt.detail.intersection);
          upPosition = evt.detail.intersection.point;
          console.log("up", upPosition);
        });
      }
    });
  </script>
  <a-scene>
    <a-camera no-click-look-controls wasd-controls='easing:10'>
      <a-cursor></a-cursor>
    </a-camera>
    <a-sky color='#4CC3D9' fuse timeout='100'></a-sky>
  </a-scene>
</body>

</html>
